#!/usr/bin/env python3
"""
Creates a list of exclusions from the provided metadata TSV in the Nextstrain
exclusions.txt convention. Prints the list to stdout.
"""
import logging
import argparse
import pandas as pd
from pathlib import Path
from datetime import date


LOG = logging.getLogger(__name__)


if __name__ == '__main__':
    base = Path(__file__).resolve().parent.parent

    parser = argparse.ArgumentParser(
        description="Warn about future dates in a metadata TSV file.",
        formatter_class=argparse.RawTextHelpFormatter
    )
    parser.add_argument("metadata",
        nargs="?",
        default=base / "data/metadata.tsv",
        help="Location of generated metadata tsv. Defaults to `data/metadata.tsv`")
    args = parser.parse_args()

    metadata = pd.read_csv(args.metadata, sep="\t")
    metadata.loc[metadata.date > str(date.today()), 'reason'] = '# Collection date in the future'

    excluded_strains = metadata.loc[metadata.reason.notnull()]

    print(excluded_strains[['strain', 'reason']].to_csv(header=False, index=False, sep='\t'))
